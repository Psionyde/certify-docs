<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Scripting Hooks · Certify The Web - Docs</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Request Script Hooks"/><meta property="og:title" content="Scripting Hooks · Certify The Web - Docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://certifytheweb.com/index.html"/><meta property="og:description" content="# Request Script Hooks"/><meta property="og:image" content="https://certifytheweb.com/img/favicon.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://certifytheweb.com/img/favicon.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/icon.svg" alt="Certify The Web - Docs"/><h2 class="headerTitleWithLogo">Certify The Web - Docs</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/intro.html" target="_self">Getting Started</a></li><li class="siteNavGroupActive"><a href="/docs/faq.html" target="_self">FAQ</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Getting Started</h3><ul><li class="navListItem"><a class="navItem" href="/docs/intro.html">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/letsencrypt.html">What is Let&#x27;s Encrypt?</a></li><li class="navListItem"><a class="navItem" href="/docs/certificate-process.html">Certificate Request Process</a></li><li class="navListItem"><a class="navItem" href="/docs/ui-options.html">Guide to UI Options</a></li><li class="navListItem"><a class="navItem" href="/docs/renewals.html">Certificate Renewals</a></li><li class="navListItem"><a class="navItem" href="/docs/faq.html">Frequently Asked Questions</a></li></ul></div><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem"><a class="navItem" href="/docs/dns-validation.html">About DNS Validation (dns-01)</a></li><li class="navListItem"><a class="navItem" href="/docs/http-validation.html">About HTTP Validation (http-01)</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/script-hooks.html">Scripting Hooks</a></li></ul></div><div class="navGroup navGroupActive"><h3>Useful Info</h3><ul><li class="navListItem"><a class="navItem" href="/docs/ssl-windows.html">Using Certificates in Windows</a></li><li class="navListItem"><a class="navItem" href="/docs/commandline.html">Command Line (CLI) Options</a></li><li class="navListItem"><a class="navItem" href="/docs/csv-import.html">CSV Bulk Import via Command Line</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/webprofusion/certify-docs/edit/master/docs/script-hooks.md" target="_blank" rel="noreferrer noopener">Edit</a><h1>Scripting Hooks</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="request-script-hooks"></a><a href="#request-script-hooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Request Script Hooks</h1>
<p>Certify is extendable via PowerShell scripts which can be configured to run before or after the Certificate Request. The scripts are provided a parameter <code>$result</code> which contains the status and details of the site whose certificate is being requested. You may execute any commands that the user running the test script has access to, including creating new processes, or using other command line tools.</p>
<p>A common use for script hooks is to use your new certificate for services other than IIS websites, such as Microsoft Exchange, RDP Gateway, FTP servers and other services.</p>
<p><strong>Note: Before v4, the app is 32-bit as is the PowerShell process. See the 64-bit wrapper example below to run 64-bit commands (a common issue if a command is not found). From v4 onwards the PowerShell process is 64-bit.</strong></p>
<p>By default the background service runs as Local System, so your scripts will execute in that context, this can be important for issues regarding permissions, file system encryption etc.</p>
<h2><a class="anchor" aria-hidden="true" id="script-basics"></a><a href="#script-basics" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Script Basics</h2>
<p>Here is a sample script which demonstrates a few commonly accessed pieces of information:</p>
<pre><code class="hljs css languages- PowerShell"><span class="hljs-keyword">param</span>(<span class="hljs-variable">$result</span>)   <span class="hljs-comment"># required to access the $result parameter</span>

<span class="hljs-comment"># either $true or $false</span>
<span class="hljs-variable">$result</span>.IsSuccess

<span class="hljs-comment"># object containing all information Certify has about the saved Site</span>
<span class="hljs-variable">$result</span>.ManagedItem

<span class="hljs-comment"># the IIS site ID</span>
<span class="hljs-variable">$result</span>.ManagedItem.GroupId   <span class="hljs-comment"># ex: 1, 2, 3, ...</span>

<span class="hljs-comment"># the IIS site directory</span>
<span class="hljs-variable">$result</span>.ManagedItem.RequestConfig.WebsiteRootPath   <span class="hljs-comment"># ex: "C:\inetpub\wwwroot"</span>

<span class="hljs-comment"># the path to the created/renewed certificate PFX file</span>
<span class="hljs-variable">$result</span>.MangagedItem.CertificatePath   <span class="hljs-comment"># ex: "C:\ProgramData\ACMESharp\sysVault\99-ASSET\cert_ident8cf8bd9c-all.pfx"</span>

<span class="hljs-comment"># the certificate thumbprint</span>
<span class="hljs-variable">$result</span>.ManagedItem.CertificateThumbprintHash <span class="hljs-comment"># ex: "78b1080a1bf5e7fc0bbb0c0614fc4a18932db5f9"</span>

<span class="hljs-comment"># set to $true in a pre-request hook to prevent the certificate from </span>
<span class="hljs-comment"># being requested (has no effect in post-request hooks)</span>
<span class="hljs-variable">$result</span>.Abort = <span class="hljs-literal">$false</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="pre-request-script-hooks"></a><a href="#pre-request-script-hooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pre-Request Script Hooks</h2>
<p>Notes: Pre-request scripts are executed immediately before the Certificate Request is about to be made (including the challenge file configuration checks).</p>
<ul>
<li>The <code>$result.IsSuccess</code> value will always be <code>$false</code>.</li>
<li>If for some reason your script would like to prevent the Certificate Request from being executed, you may set <code>$result.Abort</code> to <code>$true</code> and the site your script was executed for will be skipped.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="example-update-iis-site-root-directory-dynamically"></a><a href="#example-update-iis-site-root-directory-dynamically" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example: Update IIS site root directory dynamically</h3>
<pre><code class="hljs css languages- PowerShell"><span class="hljs-keyword">param</span>(<span class="hljs-variable">$result</span>)
<span class="hljs-variable">$id</span> = <span class="hljs-variable">$result</span>.ManagedItem.GroupId
<span class="hljs-variable">$domain</span> = <span class="hljs-variable">$result</span>.ManagedItem.RequestConfig.PrimaryDomain
[xml]<span class="hljs-variable">$xml</span> = . <span class="hljs-string">"<span class="hljs-variable">$env:windir</span>\system32\inetsrv\appcmd"</span> list config /section:system.applicationHost/sites
<span class="hljs-variable">$path</span> = <span class="hljs-variable">$xml</span>.SelectSingleNode(<span class="hljs-string">"//site[@id=<span class="hljs-variable">$id</span>]/application[@path='/']/virtualDirectory/@physicalPath"</span>).Value
<span class="hljs-variable">$result</span>.ManagedItem.RequestConfig.WebsiteRootPath = <span class="hljs-variable">$path</span>
<span class="hljs-built_in">write-output</span> <span class="hljs-string">"Updated Path [<span class="hljs-variable">$domain</span>]: <span class="hljs-variable">$path</span>"</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="post-request-script-hooks"></a><a href="#post-request-script-hooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Post-Request Script Hooks</h2>
<p>Notes: Post-request scripts are executed immediately after the Certificate Request was completed, whether or not the request was successful and the certificate was automatically installed and configured according to the site configuration within Certify.</p>
<ul>
<li>The <code>$result.IsSuccess</code> value indicates whether or not the Certificate Request was successfully completed.</li>
<li>The <code>$result.Message</code> value provides a message describing the reason for failure, or a message indicating success</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="example-send-email-via-gmail-after-unsuccessful-renewal"></a><a href="#example-send-email-via-gmail-after-unsuccessful-renewal" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example: Send email via Gmail after unsuccessful renewal</h3>
<pre><code class="hljs css languages- PowerShell"><span class="hljs-keyword">param</span>(<span class="hljs-variable">$result</span>)
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$result</span>.IsSuccess) {
   <span class="hljs-variable">$EmailFrom</span> = <span class="hljs-string">"username@gmail.com"</span>
   <span class="hljs-variable">$EmailTo</span> = <span class="hljs-string">"username@gmail.com"</span> 
   <span class="hljs-variable">$Subject</span> = <span class="hljs-string">"Cert Request Failed: "</span> + <span class="hljs-variable">$result</span>.ManagedItem.RequestConfig.PrimaryDomain
   <span class="hljs-variable">$Body</span> = <span class="hljs-string">"Error: "</span> + <span class="hljs-variable">$result</span>.Message 
   <span class="hljs-variable">$SMTPServer</span> = <span class="hljs-string">"smtp.gmail.com"</span> 
   <span class="hljs-variable">$SMTPClient</span> = <span class="hljs-built_in">New-Object</span> Net.Mail.SmtpClient(<span class="hljs-variable">$SmtpServer</span>, <span class="hljs-number">587</span>) 
   <span class="hljs-variable">$SMTPClient</span>.EnableSsl = <span class="hljs-literal">$true</span> 
   <span class="hljs-variable">$SMTPClient</span>.Credentials = <span class="hljs-built_in">New-Object</span> System.Net.NetworkCredential(<span class="hljs-string">"username@gmail.com"</span>, <span class="hljs-string">"password"</span>); 
   <span class="hljs-variable">$SMTPClient</span>.Send(<span class="hljs-variable">$EmailFrom</span>, <span class="hljs-variable">$EmailTo</span>, <span class="hljs-variable">$Subject</span>, <span class="hljs-variable">$Body</span>)
   <span class="hljs-built_in">write-output</span> <span class="hljs-string">"Sent notification email"</span>
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="example-restart-rras-after-successful-certificate-renewal"></a><a href="#example-restart-rras-after-successful-certificate-renewal" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example: Restart RRAS after successful certificate renewal</h3>
<pre><code class="hljs css languages- PowerShell"><span class="hljs-keyword">param</span>(<span class="hljs-variable">$result</span>)
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>.IsSuccess -and <span class="hljs-variable">$result</span>.ManagedItem.GroupId <span class="hljs-nomarkup">-eq</span> <span class="hljs-number">1</span>) {
   <span class="hljs-built_in">write-output</span> <span class="hljs-string">"Restarting RRAS..."</span>
   Net Stop RemoteAccess
   Net Start RemoteAccess
   <span class="hljs-built_in">write-output</span> <span class="hljs-string">"Done"</span>
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="example-convert-cng-certificate-storage-to-csp-for-exchange-2013"></a><a href="#example-convert-cng-certificate-storage-to-csp-for-exchange-2013" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example: Convert CNG certificate storage to CSP (for Exchange 2013)</h3>
<pre><code class="hljs css languages- PowerShell"><span class="hljs-keyword">param</span>(<span class="hljs-variable">$result</span>)
<span class="hljs-variable">$tempfile</span> = <span class="hljs-string">"<span class="hljs-variable">$env:TEMP</span>\CertifyTemp.pfx"</span>
<span class="hljs-variable">$pfx</span> = <span class="hljs-built_in">get-pfxcertificate</span> -filepath <span class="hljs-variable">$result</span>.ManagedItem.CertificatePath
certutil -f -p Certify -exportpfx <span class="hljs-variable">$pfx</span>.SerialNumber <span class="hljs-variable">$tempfile</span>
certutil -delstore my <span class="hljs-variable">$pfx</span>.SerialNumber
certutil -p Certify -csp <span class="hljs-string">"Microsoft RSA SChannel Cryptographic Provider"</span> -importpfx <span class="hljs-variable">$tempfile</span>
<span class="hljs-built_in">remove-item</span> <span class="hljs-variable">$tempfile</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="example-enable-certificate-for-exchange-2013-2016-services-on-same-server"></a><a href="#example-enable-certificate-for-exchange-2013-2016-services-on-same-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example: Enable certificate for Exchange 2013 / 2016 services on same server</h3>
<pre><code class="hljs css languages- PowerShell"><span class="hljs-keyword">param</span>(<span class="hljs-variable">$result</span>)
Enable-ExchangeCertificate -Thumbprint <span class="hljs-variable">$result</span>.ManagedItem.CertificateThumbprintHash -Services POP,IMAP,SMTP,IIS
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="example-update-remote-desktop-role-certificates"></a><a href="#example-update-remote-desktop-role-certificates" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example: update Remote Desktop Role Certificates</h3>
<p>(switches to 64-bit powershell to import the 64-bit RemoteDesktop module)</p>
<pre><code class="hljs css languages- PowerShell"><span class="hljs-keyword">param</span>(<span class="hljs-variable">$result</span>)
<span class="hljs-built_in">set-alias</span> ps64 <span class="hljs-string">"<span class="hljs-variable">$env:windir</span>\sysnative\WindowsPowerShell\v1.0\powershell.exe"</span> 
ps64 -args <span class="hljs-variable">$result</span> -command {
   <span class="hljs-variable">$result</span> = <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>]
   <span class="hljs-variable">$pfxpath</span> = <span class="hljs-variable">$result</span>.ManagedItem.CertificatePath
   <span class="hljs-built_in">Import-Module</span> RemoteDesktop
   Set-RDCertificate -Role RDPublishing -ImportPath <span class="hljs-variable">$pfxpath</span> -Force
   Set-RDCertificate -Role RDWebAcces -ImportPath <span class="hljs-variable">$pfxpath</span> -Force
   Set-RDCertificate -Role RDGateway -ImportPath <span class="hljs-variable">$pfxpath</span> -Force
   Set-RDCertificate -Role RDRedirector -ImportPath <span class="hljs-variable">$pfxpath</span> -Force
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="troubleshooting"></a><a href="#troubleshooting" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Troubleshooting</h2>
<ul>
<li>In the Certify UI, you may test scripts by clicking the &quot;Test&quot; button after entering the script filename for the hook you would like to test.</li>
<li>For a testing pre-request script, the <code>$result.IsSuccess</code> value will be <code>$false</code>, and for a post-request script the value will be <code>$true</code>.</li>
<li>The <code>$result.MangagedItem.CertificatePath</code> value be set to the filename (including path) of the PFX file containing the requested certificate, unless the site is new and has not had a successful Certificate Request, in which case the value will not be set.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="using-64-bit-modules"></a><a href="#using-64-bit-modules" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using 64-bit modules</h3>
<p>If you attempt to import a module with <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/import-module?view=powershell-5.1"><code>Import-Module</code></a> that does not run in 32-bit mode (i.e. RemoteDesktop), you may receive an error like <code>&quot;Import-Module : The specified module 'RemoteDesktop' was not loaded because no valid module file was found in any module directory.&quot;</code>. To load a 64-bit module you can use this snippet to pass the <code>$result</code> object to a script running in 64-bit powershell:</p>
<pre><code class="hljs css languages- powershell"><span class="hljs-keyword">param</span>(<span class="hljs-variable">$result</span>)
<span class="hljs-built_in">set-alias</span> ps64 <span class="hljs-string">"<span class="hljs-variable">$env:windir</span>\sysnative\WindowsPowerShell\v1.0\powershell.exe"</span> 
ps64 -args <span class="hljs-variable">$result</span> -command {
   <span class="hljs-variable">$result</span> = <span class="hljs-variable">$args</span>[<span class="hljs-number">0</span>]
   <span class="hljs-built_in">write-output</span> <span class="hljs-variable">$result</span>.IsSuccess
   <span class="hljs-built_in">import-module</span> -name RemoteDesktop
   Set-RDCertificate ...
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="http-validation.html">← About HTTP Validation (http-01)</a><a class="docs-next button" href="ssl-windows.html">Using Certificates in Windows →</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#script-basics">Script Basics</a></li><li><a href="#pre-request-script-hooks">Pre-Request Script Hooks</a><ul class="toc-headings"><li><a href="#example-update-iis-site-root-directory-dynamically">Example: Update IIS site root directory dynamically</a></li></ul></li><li><a href="#post-request-script-hooks">Post-Request Script Hooks</a><ul class="toc-headings"><li><a href="#example-send-email-via-gmail-after-unsuccessful-renewal">Example: Send email via Gmail after unsuccessful renewal</a></li><li><a href="#example-restart-rras-after-successful-certificate-renewal">Example: Restart RRAS after successful certificate renewal</a></li><li><a href="#example-convert-cng-certificate-storage-to-csp-for-exchange-2013">Example: Convert CNG certificate storage to CSP (for Exchange 2013)</a></li><li><a href="#example-enable-certificate-for-exchange-2013-2016-services-on-same-server">Example: Enable certificate for Exchange 2013 / 2016 services on same server</a></li><li><a href="#example-update-remote-desktop-role-certificates">Example: update Remote Desktop Role Certificates</a></li></ul></li><li><a href="#troubleshooting">Troubleshooting</a><ul class="toc-headings"><li><a href="#using-64-bit-modules">Using 64-bit modules</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/icon.svg" alt="Certify The Web - Docs" width="66" height="58"/></a><div><h5>Community</h5><a href="https://community.certifytheweb.com" target="_blank" rel="noreferrer noopener">Discuss</a><a href="https://twitter.com/certifytheweb/" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://github.com/webprofusion/certify">GitHub</a></div><div><h5>Help</h5><a href="https://certifytheweb.com/">Website</a><a href="https://certifytheweb.com/docs">Support</a><a href="https://github.com/webprofusion/certify/issues">Issues</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2018 Webprofusion Pty Ltd</section></footer></div></body></html>