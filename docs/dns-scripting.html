<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>DNS Scripting · Certify The Web - Docs</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;To provide your own script to update DNS you need to create (or source) a Windows (CMD) batch file which expects the following sequence of arguments and update a corresponding TXT record in your DNS zone:&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="DNS Scripting · Certify The Web - Docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://certifytheweb.com/index.html"/><meta property="og:description" content="&lt;p&gt;To provide your own script to update DNS you need to create (or source) a Windows (CMD) batch file which expects the following sequence of arguments and update a corresponding TXT record in your DNS zone:&lt;/p&gt;
"/><meta property="og:image" content="https://certifytheweb.com/img/favicon.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://certifytheweb.com/img/favicon.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/icon.svg" alt="Certify The Web - Docs"/><h2 class="headerTitleWithLogo">Certify The Web - Docs</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/intro.html" target="_self">Getting Started</a></li><li class=""><a href="/docs/faq.html" target="_self">FAQ</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/webprofusion/certify-docs/edit/master/docs/dns-scripting.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">DNS Scripting</h1></header><article><div><span><p>To provide your own script to update DNS you need to create (or source) a Windows (CMD) batch file which expects the following sequence of arguments and update a corresponding TXT record in your DNS zone:</p>
<ul>
<li>Target Domain (e.g. <code>example.com</code>)</li>
<li>Record Name (e.g. <code>_acme-challenge.example.com</code>)</li>
<li>Record Value (e.g. <code>ABCBD123456789</code>)</li>
<li>Zone Id (e.g. <code>OptionalZoneId</code>, this is often useful to match the specific zone to update)</li>
</ul>
<p>e.g. given a script at <em>C:\customscripts\UpdateDNS.bat</em>, this will be executed as:</p>
<pre><code class="hljs">C:\customscripts\UpdateDNS<span class="hljs-selector-class">.bat</span> example<span class="hljs-selector-class">.com</span> _acme-challenge<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span> ABCBD123456789 OptionalZoneId
</code></pre>
<p>Important Notes:</p>
<ul>
<li>Your script will run as the background service user (local system), not as your account.</li>
<li>You should assume the working directory of the process will not be the same as the script.</li>
<li>When an 'apex domain' like <code>example.com</code> is included in the certificate request for a wildcard (e.g. <code>*.example.com</code>) both TXT records will have the same name but different values, so updates need to add to the TXT record values. For this reason it's also a good idea to provide a (well tested!) delete script to clean up the TXT record once the request has completed, otherwise your TXT record values will grow with every validation attempt.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="calling-a-python-or-node-script"></a><a href="#calling-a-python-or-node-script" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Calling a Python or node script</h2>
<p>To use a Python script (or similarly Node etc) start with a .bat file which can then forward all the arguments as required to your script using <code>%*</code> (or you could pass specific arguments if you needed). Note also the fully qualified path to the python exe (or node) as your script will run as local system (using the apps background service) and the path environment variable settings may be different:</p>
<pre><code class="hljs css language-bat"><span class="hljs-comment">REM This script would be called with the parameters &lt;target domain&gt; &lt;record name&gt; &lt;record value&gt; &lt;zone id (optionally)&gt;</span>
<span class="hljs-comment">
REM this example then calls a custom python script forwarding all the arguments</span>
<span class="hljs-function">
c:\<span class="hljs-title">python27</span>\<span class="hljs-title">python.exe</span> <span class="hljs-title">create_dns_txt_example.py</span> %*
</span></code></pre>
<p>In the following Pythong example the args are available in the <code>sys.argv</code> list. This example passes that list to a function called <code>main</code> and logs some example stuff (<code>create_dns_txt_example.py</code> logging to <code>dns_create_test.log</code>).</p>
<p>Your real script would use your DNS providers API or a library such as Apache libcloud.</p>
<pre><code class="hljs css language-python"><span class="hljs-comment"># Example</span>

<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> getopt
<span class="hljs-keyword">import</span> logging

<span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> added module for DNS updates (libcloud etc)</span>


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(argv)</span>:</span>

    <span class="hljs-comment"># init logging etc</span>
    logging.basicConfig(filename=<span class="hljs-string">'dns_create_test.log'</span>,
                        filemode=<span class="hljs-string">'a'</span>, level=logging.INFO)

    logging.info(<span class="hljs-string">"Example Python DNS helper."</span>)

   <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> setup your DNS provider (apache libcloud etc)</span>

   <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> add/append the txt record</span>

    logging.info(<span class="hljs-string">"args: "</span> + <span class="hljs-string">" "</span>.join(sys.argv))

    logging.info(
        <span class="hljs-string">"If this script did anything it would create a TXT record called "</span> + sys.argv[<span class="hljs-number">2</span>]
        + <span class="hljs-string">" with the value "</span> + sys.argv[<span class="hljs-number">3</span>]
        + <span class="hljs-string">" you could optionally use the domain ("</span>+sys.argv[<span class="hljs-number">1</span>]+<span class="hljs-string">") "</span>
        + <span class="hljs-string">" or zoneId ("</span>+sys.argv[<span class="hljs-number">4</span>]+<span class="hljs-string">") in your python script"</span>)


<span class="hljs-comment">#########################################</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main(sys.argv)

</code></pre>
<p>When the script runs that app will call the .bat file like:</p>
<pre><code class="hljs">ExampleDNSCreatePython<span class="hljs-selector-class">.bat</span> mydomain<span class="hljs-selector-class">.com</span> _acme-challenge<span class="hljs-selector-class">.mydomain</span><span class="hljs-selector-class">.com</span> ABCD1234 myoptionalZoneId
</code></pre>
<p>Which in turn (based on the above example .bat) will call the python script as :</p>
<pre><code class="hljs">python create_dns_txt_basic<span class="hljs-selector-class">.py</span><span class="hljs-selector-class">.bat</span> mydomain<span class="hljs-selector-class">.com</span> _acme-challenge<span class="hljs-selector-class">.mydomain</span><span class="hljs-selector-class">.com</span> ABCD1234 myoptionalZoneId
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#calling-a-python-or-node-script">Calling a Python or node script</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/icon.svg" alt="Certify The Web - Docs" width="66" height="58"/></a><div><h5>Community</h5><a href="https://community.certifytheweb.com" target="_blank" rel="noreferrer noopener">Discuss</a><a href="https://twitter.com/certifytheweb/" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://github.com/webprofusion/certify">GitHub</a></div><div><h5>Help</h5><a href="https://certifytheweb.com/">Website</a><a href="https://certifytheweb.com/docs">Support</a><a href="https://github.com/webprofusion/certify/issues">Issues</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Webprofusion Pty Ltd</section></footer></div></body></html>